<!DOCTYPE html>
<html>

<head>
    <title>template</title>
    <meta http-equiv="Content-type" content="text/html;charset=utf-8" />
    <meta name="Description" content="Learning Rust Wasm/Webassembly programming and having fun">
    <meta name="author" content="https://github.com/bestia-dev">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/bestia01.css">
    <script>
        /* Toggle between adding and removing the "responsive" class to navbar when the user clicks on the hamburger */
        function toggle_responsive_navbar() {
            var x = document.getElementById("navbar");
            if (x.className.includes(" responsive")) {
                x.className = x.className.replace(" responsive", "");
            } else {
                x.className += " responsive";
            }
        }
    </script>
</head>

<body>
    <div class="fixed_header">
        <div id="navbar">
            <a id="navbar_brand" href="https://bestia.dev">
                <img src="bestia_icon.png" alt="Bestia development" title="bestia.dev" />
                <span id="navbar_title"> Bestia dev</span>
            </a>
            <a id="navbar_hamburger" href="javascript:void(0);" onclick="toggle_responsive_navbar()">â˜° </a>
            <div id="navbar_topics">
                <a href="/index.html#home" onclick="toggle_responsive_navbar()">Home </a>
                <a href="/index.html#tutorials" onclick="toggle_responsive_navbar()">Tutorials</a>
                <a href="/index.html#games" onclick="toggle_responsive_navbar()">Games</a>
                <a href="/index.html#productivity" onclick="toggle_responsive_navbar()">Productivity</a>
                <a href="/index.html#contact" onclick="toggle_responsive_navbar()">Contact</a>
            </div>
        </div>
    </div>

<article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-mem2" class="anchor" aria-hidden="true" href="#mem2"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>mem2</h1>
<p dir="auto"><strong>Learning to use Rust with WebSockets communication</strong><br>
<em><strong>version: 2.0  date: 2019-05-10 author: <a href="https://bestia.dev" rel="nofollow">bestia.dev</a> repository: <a href="https://github.com/bestia-dev/mem2">GitHub</a></strong></em></p>
<p dir="auto"><a href="https://hits.seeyoufarm.com" rel="nofollow"><img src="https://camo.githubusercontent.com/0932ac6f722e6aa1f5de6428719dc3ee3fe0105565ec4bf72ceec14380c4375e/68747470733a2f2f686974732e736565796f756661726d2e636f6d2f6170692f636f756e742f696e63722f62616467652e7376673f75726c3d68747470732533412532462532466769746875622e636f6d2532466265737469612d6465762532466d656d3226636f756e745f62673d253233373943383344267469746c655f62673d2532333535353535352669636f6e3d2669636f6e5f636f6c6f723d253233453745374537267469746c653d6869747326656467655f666c61743d66616c7365" alt="Hits" data-canonical-src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fgithub.com%2Fbestia-dev%2Fmem2&amp;count_bg=%2379C83D&amp;title_bg=%23555555&amp;icon=&amp;icon_color=%23E7E7E7&amp;title=hits&amp;edge_flat=false" style="max-width: 100%;"></a></p>
<p dir="auto">Hashtags: #rustlang #game #tutorial</p>
<p dir="auto">Read the <code>Last project</code>:<br>
<a href="https://github.com/bestia-dev/mem1">https://github.com/bestia-dev/mem1</a></p>
<p dir="auto">On the base of mem1 (Rust Wasm/WebAssembly with Dodrio Virtual Dom) added WebSockets communication - second iteration.<br>
This is a simple memory game for kids. The images are funny cartoon characters from the alphabet.<br>
The cards grid is only 4x4.<br>
For fun I added</p>
<ul dir="auto">
<li>the sounds of Morse alphabet codes and</li>
<li>the International Aviation spelling.</li>
</ul>
<p dir="auto">You can play the game here (hosted on google cloud platform):<br>
<a href="https://bestia.dev/mem2" rel="nofollow">https://bestia.dev/mem2</a></p>
<h2 dir="auto"><a id="user-content-build" class="anchor" aria-hidden="true" href="#build"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Build</h2>
<p dir="auto">Clone and build</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="git clone git@github.com:bestia-dev/mem2.git
cd mem2
wasm-pack build --target web  "><pre>git clone git@github.com:bestia-dev/mem2.git
<span class="pl-c1">cd</span> mem2
wasm-pack build --target web  </pre></div>
<p dir="auto">You cannot use this project without a html/WebSocket server. Read the next chapter.</p>
<h2 dir="auto"><a id="user-content-serve" class="anchor" aria-hidden="true" href="#serve"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Serve</h2>
<p dir="auto">The mem2_server project and instructions is here:<br>
<a href="https://github.com/bestia-dev/mem2_server">https://github.com/bestia-dev/mem2_server</a><br>
For development, you have to run the game from the mem2_server. So you will have both the server and client side working.<br>
Copy the <code>mem2/pkg/</code> folder to <code>mem2_server/mem2/pkg</code>. This is the compiled wasm code.<br>
After building and running the server,<br>
<code>cd mem2_server cargo run</code><br>
it will print the External IP Address e.g. 192.168.0.22<br>
Open your browser and use that address.<br>
The game is made for exactly 2 players. Open 2 browser windows with the same address.<br>
Preferably use 2 smartphones on the same WiFi network.</p>
<h2 dir="auto"><a id="user-content-memory-game-rules" class="anchor" aria-hidden="true" href="#memory-game-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Memory game rules</h2>
<p dir="auto">This game is for exactly 2 players.<br>
Both players must have the webpage simultaneously opened in the browser to allow communication.<br>
To start over just refresh the webpage.<br>
The first player clicks on 'Ask Player2 to play?' and broadcasts the message over WebSocket.<br>
Player2 then sees on the screen 'Click here to Accept play!', clicks it and sends the message back to Player1.<br>
The game starts with a grid of 8 randomly shuffled card pairs face down - 16 cards in all.<br>
On the screen under the grid are clear signals which player plays and which waits.<br>
Player1 flips over two cards with two clicks.<br>
If the cards do not match, the other player clicks on 'Click here to Take your turn' and both cards are flipped back face down. Then it is his turn and he clicks to flip over his two cards.<br>
If the cards match, they are left face up permanently and the player receives a point. He continues to play, he opens the next two cards.<br>
The player with more points wins.</p>
<h2 dir="auto"><a id="user-content-upgrades-refactoring-and-enhancement-over-mem1" class="anchor" aria-hidden="true" href="#upgrades-refactoring-and-enhancement-over-mem1"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Upgrades, refactoring and enhancement over mem1</h2>
<p dir="auto">I decided that the project "mem1" is good as it is.<br>
It is a tutorial how to create a simple wasm with Rust Wasm/WebAssembly with Dodrio Virtual Dom and turn it into a webpage, electron and PhoneGap app. Very multiplatform !<br>
Adding anything more would make it difficult to understand and to follow the code.<br>
That is why I started a second project "mem2". I continue on the foundation of mem1 and will add stuff.<br>
Hopefully more advanced and interesting.<br>
Read the interesting StructModel.md to understand the basics of the new structs and data. I tried to use <code>dynamic borrow checker</code>. Then I realized, it was not a smart move. It was not how Rust should work. I will try to rethink it in the next iteration using <code>lifetimes</code> and <code>static borrow checker</code>.<br>
I built a 2 player mode over WebSockets. With lot of refactoring and enhancements to make the code more Rust idiomatic. I added image transitions and sounds. All 100% Rust code. I learned to use Clippy and the Browser F12 Console. The html+JavaScript+css part didn't change much. It is just "boilerplate code".<br>
I opened an account on Azure and create a Linux Virtual Machine to host the game server mem2_server and then closed it. And then opened a google cloud platform account and repeat. I learned how to build with Rust and Warp a http + WebSocket server that listen on the same port.<br>
I learned a lot!<br>
And there is more to learn. The parts of Rust that are very different from other languages are the toughest. A totally new way of thinking.</p>
<h2 dir="auto"><a id="user-content-vscode" class="anchor" aria-hidden="true" href="#vscode"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>VSCode</h2>
<p dir="auto">I use <code>//region:</code> and <code>//endregion</code> a lot. To Fold it and UnFold it press <code>F1</code> type <code>fold</code> and choose from a variety of options. Start with <code>Fold All</code></p>
<h2 dir="auto"><a id="user-content-next-projects" class="anchor" aria-hidden="true" href="#next-projects"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>Next projects</h2>
<p dir="auto"><a href="https://github.com/bestia-dev/mem3_game">https://github.com/bestia-dev/mem3_game</a></p>
<h2 dir="auto"><a id="user-content-cargo-crev-reviews-and-advisory" class="anchor" aria-hidden="true" href="#cargo-crev-reviews-and-advisory"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>cargo crev reviews and advisory</h2>
<p dir="auto">It is recommended to always use <a href="https://github.com/crev-dev/cargo-crev">cargo-crev</a><br>
to verify the trustworthiness of each of your dependencies.<br>
Please, spread this info.<br>
On the web use this url to read crate reviews. Example:<br>
<a href="https://web.crev.dev/rust-reviews/crate/num-traits/" rel="nofollow">https://web.crev.dev/rust-reviews/crate/num-traits/</a></p>
<h2 dir="auto"><a id="user-content-references" class="anchor" aria-hidden="true" href="#references"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>References</h2>
<p dir="auto">Rust<br>
<a href="https://doc.rust-lang.org/book/" rel="nofollow">https://doc.rust-lang.org/book/</a><br>
<a href="https://rust-lang-nursery.github.io/rust-cookbook/" rel="nofollow">https://rust-lang-nursery.github.io/rust-cookbook/</a><br>
virtual Dom<br>
<a href="https://github.com/fitzgen/dodrio">https://github.com/fitzgen/dodrio</a><br>
web, http, css<br>
<a href="https://github.com/brson/basic-http-server">https://github.com/brson/basic-http-server</a><br>
<a href="https://www.w3schools.com/w3css/" rel="nofollow">https://www.w3schools.com/w3css/</a><br>
WebSocket<br>
<a href="https://ws-rs.org/" rel="nofollow">https://ws-rs.org/</a>
<a href="https://github.com/housleyjk/ws-rs">https://github.com/housleyjk/ws-rs</a><br>
wasm, wasm-bindgen<br>
<a href="https://rustwasm.github.io/docs/wasm-bindgen" rel="nofollow">https://rustwasm.github.io/docs/wasm-bindgen</a><br>
<a href="https://github.com/anderejd/wasm-bindgen-minimal-example">https://github.com/anderejd/wasm-bindgen-minimal-example</a><br>
<a href="https://github.com/grizwako/rust-wasm-chat-frontend">https://github.com/grizwako/rust-wasm-chat-frontend</a><br>
JsValue, future, promises<br>
<a href="https://crates.io/crates/wasm-bindgen-futures" rel="nofollow">https://crates.io/crates/wasm-bindgen-futures</a><br>
<a href="https://github.com/fitzgen/dodrio/blob/master/examples/todomvc/src/router.rs">https://github.com/fitzgen/dodrio/blob/master/examples/todomvc/src/router.rs</a><br>
random<br>
<a href="https://rust-random.github.io/book/" rel="nofollow">https://rust-random.github.io/book/</a><br>
Images included free cartoon characters:<br>
<a href="https://vectorcharacters.net/alphabet-vectors/alphabet-cartoon-characters" rel="nofollow">https://vectorcharacters.net/alphabet-vectors/alphabet-cartoon-characters</a><br>
Favicon from<br>
<a href="https://www.favicon-generator.org/search/BLACK/M" rel="nofollow">https://www.favicon-generator.org/search/BLACK/M</a><br>
Reference counting, Borrow Checker in runtime instead of compile time<br>
<a href="https://manishearth.github.io/blog/2015/05/27/wrapper-types-in-rust-choosing-your-guarantees/" rel="nofollow">https://manishearth.github.io/blog/2015/05/27/wrapper-types-in-rust-choosing-your-guarantees/</a></p>
</article>
</body>

</html>